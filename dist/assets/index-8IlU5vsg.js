(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))o(a);new MutationObserver(a=>{for(const r of a)if(r.type==="childList")for(const i of r.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&o(i)}).observe(document,{childList:!0,subtree:!0});function t(a){const r={};return a.integrity&&(r.integrity=a.integrity),a.referrerPolicy&&(r.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?r.credentials="include":a.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function o(a){if(a.ep)return;a.ep=!0;const r=t(a);fetch(a.href,r)}})();let B=[],st=(e,n)=>{let t,o=[],a={lc:0,l:n||0,value:e,set(r){a.value=r,a.notify()},get(){return a.lc||a.listen(()=>{})(),a.value},notify(r){t=o;let i=!B.length;for(let c=0;c<t.length;c+=2)B.push(t[c],a.value,r,t[c+1]);if(i){for(let c=0;c<B.length;c+=4){let s=!1;for(let l=c+7;l<B.length;l+=4)if(B[l]<B[c+3]){s=!0;break}s?B.push(B[c],B[c+1],B[c+2],B[c+3]):B[c](B[c+1],B[c+2])}B.length=0}},listen(r,i){return o===t&&(o=o.slice()),a.lc=o.push(r,i||a.l)/2,()=>{o===t&&(o=o.slice());let c=o.indexOf(r);~c&&(o.splice(c,2),a.lc--,a.lc||a.off())}},subscribe(r,i){let c=a.listen(r,i);return r(a.value),c},off(){}};return a},lt=(e={})=>{let n=st(e);return n.setKey=function(t,o){typeof o>"u"?t in n.value&&(n.value={...n.value},delete n.value[t],n.notify(t)):n.value[t]!==o&&(n.value={...n.value,[t]:o},n.notify(t))},n};if(typeof DelayNode<"u"){class e extends DelayNode{constructor(t,o,a,r){super(t),o=Math.abs(o),this.delayTime.value=a;const i=t.createGain();i.gain.value=Math.min(Math.abs(r),.995),this.feedback=i.gain;const c=t.createGain();return c.gain.value=o,this.delayGain=c,this.connect(i),this.connect(c),i.connect(this),this.connect=s=>c.connect(s),this}start(t){this.delayGain.gain.setValueAtTime(this.delayGain.gain.value,t+this.delayTime.value)}}AudioContext.prototype.createFeedbackDelay=function(n,t,o){return new e(this,n,t,o)}}var be={};be.generateReverb=function(e,n){for(var t=e.audioContext||new AudioContext,o=t.sampleRate,a=e.numChannels||2,r=e.decayTime*1.5,i=Math.round(e.decayTime*o),c=Math.round(r*o),s=Math.round((e.fadeInTime||0)*o),l=Math.pow(1/1e3,1/i),u=t.createBuffer(a,c,o),g=0;g<a;g++){for(var d=u.getChannelData(g),f=0;f<c;f++)d[f]=gt()*Math.pow(l,f);for(var f=0;f<s;f++)d[f]*=f/s}ut(u,e.lpFreqStart||0,e.lpFreqEnd||0,e.decayTime,n)};be.generateGraph=function(e,n,t,o,a){var r=document.createElement("canvas");r.width=n,r.height=t;var i=r.getContext("2d");i.fillStyle="#000",i.fillRect(0,0,r.width,r.height),i.fillStyle="#fff";for(var c=n/e.length,s=t/(a-o),l=0;l<e.length;l++)i.fillRect(l*c,t-(e[l]-o)*s,1,1);return r};var ut=function(e,n,t,o,a){if(n==0){a(e);return}var r=dt(e),i=new OfflineAudioContext(e.numberOfChannels,r[0].length,e.sampleRate),c=i.createBufferSource();c.buffer=e;var s=i.createBiquadFilter();n=Math.min(n,e.sampleRate/2),t=Math.min(t,e.sampleRate/2),s.type="lowpass",s.Q.value=1e-4,s.frequency.setValueAtTime(n,0),s.frequency.linearRampToValueAtTime(t,o),c.connect(s),s.connect(i.destination),c.start(),i.oncomplete=function(l){a(l.renderedBuffer)},i.startRendering(),window.filterNode=s},dt=function(e){for(var n=[],t=0;t<e.numberOfChannels;t++)n[t]=e.getChannelData(t);return n},gt=function(){return Math.random()*2-1};typeof AudioContext<"u"&&(AudioContext.prototype.adjustLength=function(e,n){const t=n.sampleRate*e,o=this.createBuffer(n.numberOfChannels,n.length,n.sampleRate);for(let a=0;a<n.numberOfChannels;a++){let r=n.getChannelData(a),i=o.getChannelData(a);for(let c=0;c<t;c++)i[c]=r[c]||0}return o},AudioContext.prototype.createReverb=function(e,n,t,o,a){const r=this.createConvolver();return r.generate=(i=2,c=.1,s=15e3,l=1e3,u)=>{r.duration=i,r.fade=c,r.lp=s,r.dim=l,r.ir=u,u?r.buffer=this.adjustLength(i,u):be.generateReverb({audioContext:this,numChannels:2,decayTime:i,fadeInTime:c,lpFreqStart:s,lpFreqEnd:l},g=>{r.buffer=g})},r.generate(e,n,t,o,a),r});var Ye={a:{freqs:[660,1120,2750,3e3,3350],gains:[1,.5012,.0708,.0631,.0126],qs:[80,90,120,130,140]},e:{freqs:[440,1800,2700,3e3,3300],gains:[1,.1995,.1259,.1,.1],qs:[70,80,100,120,120]},i:{freqs:[270,1850,2900,3350,3590],gains:[1,.0631,.0631,.0158,.0158],qs:[40,90,100,120,120]},o:{freqs:[430,820,2700,3e3,3300],gains:[1,.3162,.0501,.0794,.01995],qs:[40,80,100,120,120]},u:{freqs:[370,630,2750,3e3,3400],gains:[1,.1,.0708,.0316,.01995],qs:[40,60,100,120,120]}};if(typeof GainNode<"u"){class e extends GainNode{constructor(t,o){if(super(t),!Ye[o])throw new Error("vowel: unknown vowel "+o);const{gains:a,qs:r,freqs:i}=Ye[o],c=t.createGain();for(let s=0;s<5;s++){const l=t.createGain();l.gain.value=a[s];const u=t.createBiquadFilter();u.type="bandpass",u.Q.value=r[s],u.frequency.value=i[s],this.connect(u),u.connect(l),l.connect(c)}return c.gain.value=8,this.connect=s=>c.connect(s),this}}AudioContext.prototype.createVowelFilter=function(n){return new e(this,n)}}const ft=e=>{var a;if(typeof e!="string")return[];const[n,t="",o]=((a=e.match(/^([a-gA-G])([#bsf]*)([0-9]*)$/))==null?void 0:a.slice(1))||[];return n?[n,t,o?Number(o):void 0]:[]},pt={c:0,d:2,e:4,f:5,g:7,a:9,b:11},ht={"#":1,b:-1,s:1,f:-1},me=(e,n=3)=>{const[t,o,a=n]=ft(e);if(!t)throw new Error('not a note: "'+e+'"');const r=pt[t.toLowerCase()],i=(o==null?void 0:o.split("").reduce((c,s)=>c+ht[s],0))||0;return(Number(a)+1)*12+r+i},It=e=>Math.pow(2,(e-69)/12)*440,he=(e,n,t)=>Math.min(Math.max(e,n),t),bt=e=>12*Math.log(e/440)/Math.LN2+69,mt=(e,n)=>{if(typeof e!="object")throw new Error("valueToMidi: expected object value");let{freq:t,note:o}=e;if(typeof t=="number")return bt(t);if(typeof o=="string")return me(o);if(typeof o=="number")return o;if(!n)throw new Error("valueToMidi: expected freq or note to be set");return n},Ct="data:application/javascript;base64,Ly8gTElDRU5TRSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSB2My4wIHNlZSBodHRwczovL2dpdGh1Yi5jb20vZGt0cjAvV2ViRGlydC9ibG9iL21haW4vTElDRU5TRQovLyBhbGwgdGhlIGNyZWRpdCBnb2VzIHRvIGRrdHIwJ3Mgd2ViZGlydDogaHR0cHM6Ly9naXRodWIuY29tL2RrdHIwL1dlYkRpcnQvYmxvYi81Y2UzZDY5ODM2MmM1NGQ2ZTFiNjhhY2M0N2ViMjk1NWFjNjJjNzkzL2Rpc3QvQXVkaW9Xb3JrbGV0cy5qcwovLyA8MwoKY2xhc3MgQ29hcnNlUHJvY2Vzc29yIGV4dGVuZHMgQXVkaW9Xb3JrbGV0UHJvY2Vzc29yIHsKICBzdGF0aWMgZ2V0IHBhcmFtZXRlckRlc2NyaXB0b3JzKCkgewogICAgcmV0dXJuIFt7IG5hbWU6ICdjb2Fyc2UnLCBkZWZhdWx0VmFsdWU6IDEgfV07CiAgfQoKICBjb25zdHJ1Y3RvcigpIHsKICAgIHN1cGVyKCk7CiAgICB0aGlzLm5vdFN0YXJ0ZWQgPSB0cnVlOwogIH0KCiAgcHJvY2VzcyhpbnB1dHMsIG91dHB1dHMsIHBhcmFtZXRlcnMpIHsKICAgIGNvbnN0IGlucHV0ID0gaW5wdXRzWzBdOwogICAgY29uc3Qgb3V0cHV0ID0gb3V0cHV0c1swXTsKICAgIGNvbnN0IGNvYXJzZSA9IHBhcmFtZXRlcnMuY29hcnNlOwogICAgY29uc3QgYmxvY2tTaXplID0gMTI4OwogICAgY29uc3QgaGFzSW5wdXQgPSAhKGlucHV0WzBdID09PSB1bmRlZmluZWQpOwogICAgaWYgKGhhc0lucHV0KSB7CiAgICAgIHRoaXMubm90U3RhcnRlZCA9IGZhbHNlOwogICAgICBvdXRwdXRbMF1bMF0gPSBpbnB1dFswXVswXTsKICAgICAgZm9yIChsZXQgbiA9IDE7IG4gPCBibG9ja1NpemU7IG4rKykgewogICAgICAgIGZvciAobGV0IG8gPSAwOyBvIDwgb3V0cHV0Lmxlbmd0aDsgbysrKSB7CiAgICAgICAgICBvdXRwdXRbb11bbl0gPSBuICUgY29hcnNlID09IDAgPyBpbnB1dFswXVtuXSA6IG91dHB1dFtvXVtuIC0gMV07CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICByZXR1cm4gdGhpcy5ub3RTdGFydGVkIHx8IGhhc0lucHV0OwogIH0KfQoKcmVnaXN0ZXJQcm9jZXNzb3IoJ2NvYXJzZS1wcm9jZXNzb3InLCBDb2Fyc2VQcm9jZXNzb3IpOwoKY2xhc3MgQ3J1c2hQcm9jZXNzb3IgZXh0ZW5kcyBBdWRpb1dvcmtsZXRQcm9jZXNzb3IgewogIHN0YXRpYyBnZXQgcGFyYW1ldGVyRGVzY3JpcHRvcnMoKSB7CiAgICByZXR1cm4gW3sgbmFtZTogJ2NydXNoJywgZGVmYXVsdFZhbHVlOiAwIH1dOwogIH0KCiAgY29uc3RydWN0b3IoKSB7CiAgICBzdXBlcigpOwogICAgdGhpcy5ub3RTdGFydGVkID0gdHJ1ZTsKICB9CgogIHByb2Nlc3MoaW5wdXRzLCBvdXRwdXRzLCBwYXJhbWV0ZXJzKSB7CiAgICBjb25zdCBpbnB1dCA9IGlucHV0c1swXTsKICAgIGNvbnN0IG91dHB1dCA9IG91dHB1dHNbMF07CiAgICBjb25zdCBjcnVzaCA9IHBhcmFtZXRlcnMuY3J1c2g7CiAgICBjb25zdCBibG9ja1NpemUgPSAxMjg7CiAgICBjb25zdCBoYXNJbnB1dCA9ICEoaW5wdXRbMF0gPT09IHVuZGVmaW5lZCk7CiAgICBpZiAoaGFzSW5wdXQpIHsKICAgICAgdGhpcy5ub3RTdGFydGVkID0gZmFsc2U7CiAgICAgIGlmIChjcnVzaC5sZW5ndGggPT09IDEpIHsKICAgICAgICBjb25zdCB4ID0gTWF0aC5wb3coMiwgY3J1c2hbMF0gLSAxKTsKICAgICAgICBmb3IgKGxldCBuID0gMDsgbiA8IGJsb2NrU2l6ZTsgbisrKSB7CiAgICAgICAgICBjb25zdCB2YWx1ZSA9IE1hdGgucm91bmQoaW5wdXRbMF1bbl0gKiB4KSAvIHg7CiAgICAgICAgICBmb3IgKGxldCBvID0gMDsgbyA8IG91dHB1dC5sZW5ndGg7IG8rKykgewogICAgICAgICAgICBvdXRwdXRbb11bbl0gPSB2YWx1ZTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZm9yIChsZXQgbiA9IDA7IG4gPCBibG9ja1NpemU7IG4rKykgewogICAgICAgICAgbGV0IHggPSBNYXRoLnBvdygyLCBjcnVzaFtuXSAtIDEpOwogICAgICAgICAgY29uc3QgdmFsdWUgPSBNYXRoLnJvdW5kKGlucHV0WzBdW25dICogeCkgLyB4OwogICAgICAgICAgZm9yIChsZXQgbyA9IDA7IG8gPCBvdXRwdXQubGVuZ3RoOyBvKyspIHsKICAgICAgICAgICAgb3V0cHV0W29dW25dID0gdmFsdWU7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICByZXR1cm4gdGhpcy5ub3RTdGFydGVkIHx8IGhhc0lucHV0OwogIH0KfQpyZWdpc3RlclByb2Nlc3NvcignY3J1c2gtcHJvY2Vzc29yJywgQ3J1c2hQcm9jZXNzb3IpOwoKY2xhc3MgU2hhcGVQcm9jZXNzb3IgZXh0ZW5kcyBBdWRpb1dvcmtsZXRQcm9jZXNzb3IgewogIHN0YXRpYyBnZXQgcGFyYW1ldGVyRGVzY3JpcHRvcnMoKSB7CiAgICByZXR1cm4gW3sgbmFtZTogJ3NoYXBlJywgZGVmYXVsdFZhbHVlOiAwIH1dOwogIH0KCiAgY29uc3RydWN0b3IoKSB7CiAgICBzdXBlcigpOwogICAgdGhpcy5ub3RTdGFydGVkID0gdHJ1ZTsKICB9CgogIHByb2Nlc3MoaW5wdXRzLCBvdXRwdXRzLCBwYXJhbWV0ZXJzKSB7CiAgICBjb25zdCBpbnB1dCA9IGlucHV0c1swXTsKICAgIGNvbnN0IG91dHB1dCA9IG91dHB1dHNbMF07CiAgICBjb25zdCBzaGFwZTAgPSBwYXJhbWV0ZXJzLnNoYXBlWzBdOwogICAgY29uc3Qgc2hhcGUxID0gc2hhcGUwIDwgMSA/IHNoYXBlMCA6IDEuMCAtIDRlLTEwOwogICAgY29uc3Qgc2hhcGUgPSAoMi4wICogc2hhcGUxKSAvICgxLjAgLSBzaGFwZTEpOwogICAgY29uc3QgYmxvY2tTaXplID0gMTI4OwogICAgY29uc3QgaGFzSW5wdXQgPSAhKGlucHV0WzBdID09PSB1bmRlZmluZWQpOwogICAgaWYgKGhhc0lucHV0KSB7CiAgICAgIHRoaXMubm90U3RhcnRlZCA9IGZhbHNlOwogICAgICBmb3IgKGxldCBuID0gMDsgbiA8IGJsb2NrU2l6ZTsgbisrKSB7CiAgICAgICAgY29uc3QgdmFsdWUgPSAoKDEgKyBzaGFwZSkgKiBpbnB1dFswXVtuXSkgLyAoMSArIHNoYXBlICogTWF0aC5hYnMoaW5wdXRbMF1bbl0pKTsKICAgICAgICBmb3IgKGxldCBvID0gMDsgbyA8IG91dHB1dC5sZW5ndGg7IG8rKykgewogICAgICAgICAgb3V0cHV0W29dW25dID0gdmFsdWU7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICByZXR1cm4gdGhpcy5ub3RTdGFydGVkIHx8IGhhc0lucHV0OwogIH0KfQoKcmVnaXN0ZXJQcm9jZXNzb3IoJ3NoYXBlLXByb2Nlc3NvcicsIFNoYXBlUHJvY2Vzc29yKTsK";function ee(e){const n=I().createGain();return n.gain.value=e,n}const Ce=(e,n,t,o,a,r)=>{const i=I().createGain();return i.gain.setValueAtTime(0,r),i.gain.linearRampToValueAtTime(a,r+e),i.gain.linearRampToValueAtTime(t*a,r+e+n),{node:i,stop:c=>{i.gain.setValueAtTime(t*a,c),i.gain.linearRampToValueAtTime(0,c+o)}}},yt=(e,n,t,o,a,r)=>{t=Math.max(.001,t),a=Math.max(.001,a);const i=I().createGain();return i.gain.setValueAtTime(1e-4,r),i.gain.exponentialRampToValueAtTime(a,r+e),i.gain.exponentialRampToValueAtTime(t*a,r+e+n),{node:i,stop:c=>{i.gain.exponentialRampToValueAtTime(1e-4,c+o)}}},At=(e,n,t,o,a,r,i,c,s)=>{const l=i-r,u=r+l,g=r+o*l;e.setValueAtTime(r,c),e.linearRampToValueAtTime(u,c+n),e.linearRampToValueAtTime(g,c+n+t),e.setValueAtTime(g,s),e.linearRampToValueAtTime(r,s+Math.max(a,.1))};function vt(e,n,t,o,a,r){const i={threshold:n??-3,ratio:t??10,knee:o??10,attack:a??.005,release:r??.05};return new DynamicsCompressorNode(e,i)}function ce(e,n,t,o,a,r,i,c,s,l,u,g=.5){const d=e.createBiquadFilter();if(d.type=n,d.Q.value=o,d.frequency.value=t,!isNaN(s)&&s!==0){const f=s*g,p=he(2**-f*t,0,2e4),m=he(2**(s-f)*t,0,2e4);return At(d.frequency,a,r,i,c,p,m,l,u),d}return d}let ze=e=>e<.5?1:1-(e-.5)/.5;function Bt(e,n,t=0){const o=I();if(!t)return e;let a=o.createGain(),r=o.createGain();e.connect(a),n.connect(r),a.gain.value=ze(t),r.gain.value=ze(1-t);let i=o.createGain();return a.connect(i),r.connect(i),i}let wt=e=>console.log(e);const Y=(...e)=>wt(...e),ie={};function Gt(e,n){var t=n?1e3:1024;if(e<t)return e+" B";var o=n?["kB","MB","GB","TB","PB","EB","ZB","YB"]:["KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"],a=-1;do e/=t,++a;while(e>=t);return e.toFixed(1)+" "+o[a]}const Rt=async(e,n,t,o,a,r,i)=>{let c=0;a!==void 0&&t!==void 0&&Y("[sampler] hap has note and freq. ignoring note","warning");let s=mt({freq:a,note:t},36);c=s-36;const l=I();let u;if(Array.isArray(r))u=r[n%r.length];else{const p=v=>me(v)-s,m=Object.keys(r).filter(v=>!v.startsWith("_")).reduce((v,C,X)=>!v||Math.abs(p(C))<Math.abs(p(v))?C:v,null);c=-p(m),u=r[m][n%r[m].length]}i&&(u=await i(u));let g=await xe(u,l,e,n);o<0&&(g=Vt(g));const d=l.createBufferSource();d.buffer=g;const f=1*Math.pow(2,c/12);return d.playbackRate.value=f,d},xe=(e,n,t,o=0)=>{const a=t?`sound "${t}:${o}"`:"sample";if(e=e.replace("#","%23"),!ie[e]){Y(`[sampler] load ${a}..`,"load-sample",{url:e});const r=Date.now();ie[e]=fetch(e).then(i=>i.arrayBuffer()).then(async i=>{const c=Date.now()-r,s=Gt(i.byteLength);return Y(`[sampler] load ${a}... done! loaded ${s} in ${c}ms`,"loaded-sample",{url:e}),await n.decodeAudioData(i)})}return ie[e]};function Vt(e){const n=I(),t=n.createBuffer(e.numberOfChannels,e.length,n.sampleRate);for(let o=0;o<e.numberOfChannels;o++)t.copyToChannel(e.getChannelData(o).slice().reverse(),o,o);return t}const Xt=(e,n,t=e._base||"")=>Object.entries(e).forEach(([o,a])=>{if(typeof a=="string"&&(a=[a]),typeof a!="object")throw new Error("wrong sample map format for "+o);t=a._base||t;const r=i=>(t+i).replace("github:","https://raw.githubusercontent.com/");Array.isArray(a)?a=a.map(r):a=Object.fromEntries(Object.entries(a).map(([i,c])=>[i,(typeof c=="string"?[c]:c).map(r)])),n(o,a)});let Tt={};function Zt(e){const n=Object.entries(Tt).find(([t])=>e.startsWith(t));if(n)return n[1]}const Qe=async(e,n=e._base||"",t={})=>{if(typeof e=="string"){const r=Zt(e);if(r)return r(e);if(e.startsWith("bubo:")){const[c,s]=e.split(":");e=`github:Bubobubobubobubo/dough-${s}`}if(e.startsWith("github:")){let[c,s]=e.split("github:");s=s.endsWith("/")?s.slice(0,-1):s,s.split("/").length===2&&(s+="/main"),e=`https://raw.githubusercontent.com/${s}/strudel.json`}if(e.startsWith("shabda:")){let[c,s]=e.split("shabda:");e=`https://shabda.ndre.gr/${s}.json?strudel=1`}if(e.startsWith("shabda/speech")){let[c,s]=e.split("shabda/speech");s=s.startsWith("/")?s.substring(1):s;let[l,u]=s.split(":"),g="f",d="en-GB";l&&([d,g]=l.split("/")),e=`https://shabda.ndre.gr/speech/${u}.json?gender=${g}&language=${d}&strudel=1'`}if(typeof fetch!="function")return;const i=e.split("/").slice(0,-1).join("/");return typeof fetch>"u"?void 0:fetch(e).then(c=>c.json()).then(c=>Qe(c,n||c._base||i,t)).catch(c=>{throw console.error(c),new Error(`error loading "${e}"`)})}const{prebake:o,tag:a}=t;Xt(e,(r,i)=>qe(r,(c,s,l)=>Ht(c,s,l,i),{type:"sample",samples:i,baseUrl:n,prebake:o,tag:a}),n)},De=[];async function Ht(e,n,t,o,a){let{s:r,freq:i,unit:c,nudge:s=0,cut:l,loop:u,clip:g=void 0,n:d=0,note:f,speed:p=1,loopBegin:m=0,begin:v=0,loopEnd:C=1,end:X=1,vib:w,vibmod:G=.5}=n;if(p===0)return;u=r.startsWith("wt_")?1:n.loop;const R=I(),{attack:A=.001,decay:z=.001,sustain:D=1,release:J=.001}=n,S=e+s,b=await Rt(r,d,f,p,i,o,a);let T;if(w>0){T=I().createOscillator(),T.frequency.value=w;const V=I().createGain();V.gain.value=G*100,T.connect(V),V.connect(b.detune),T.start(0)}if(R.currentTime>e){Y(`[sampler] still loading sound "${r}:${d}"`,"highlight");return}if(!b){Y(`[sampler] could not load "${r}:${d}"`,"error");return}b.playbackRate.value=Math.abs(p)*b.playbackRate.value,c==="c"&&(b.playbackRate.value=b.playbackRate.value*b.buffer.duration*1);const j=v*b.buffer.duration;u&&(b.loop=!0,b.loopStart=m*b.buffer.duration-j,b.loopEnd=C*b.buffer.duration-j),b.start(S,j);const{node:O,stop:te}=Ce(A,z,D,J,1,e);b.connect(O);const x=R.createGain();O.connect(x),b.onended=function(){b.disconnect(),T==null||T.stop(),O.disconnect(),x.disconnect(),t()};const Q={node:x,bufferSource:b,stop:(V,ne=g===void 0&&u===void 0)=>{let L=V;if(ne){const E=b.buffer.duration/b.playbackRate.value;L=e+(X-v)*E}b.stop(L+J),te(L)}};if(l!==void 0){const V=De[l];V&&(V.node.gain.setValueAtTime(1,S),V.node.gain.linearRampToValueAtTime(0,S+.01)),De[l]=Q}return Q}const Le=lt();function qe(e,n,t={}){Le.setKey(e,{onTrigger:n,data:t})}function se(e){return Le.get()[e]}let le;const I=()=>(le||(le=new AudioContext),le);let U;const ye=()=>{const e=I();return U||(U=e.createGain(),U.connect(e.destination)),U};let ue;function Mt(){return ue||(ue=I().audioWorklet.addModule(Ct),ue)}function de(e,n,t){const o=new AudioWorkletNode(e,n);return Object.entries(t).forEach(([a,r])=>{o.parameters.get(a).value=r}),o}async function Wt(e={}){const{disableWorklets:n=!1}=e;typeof window<"u"&&(await I().resume(),n?console.log("disableWorklets: AudioWorklet effects coarse, crush and shape are skipped!"):await Mt().catch(t=>{console.warn("could not load AudioWorklet effects coarse, crush and shape",t)}))}async function Nt(e){return new Promise(n=>{document.addEventListener("click",async function t(){await Wt(e),n(),document.removeEventListener("click",t)})})}let N={};function kt(e,n,t,o){var a;if(t=he(t,0,.98),!N[e]){const r=I().createFeedbackDelay(1,n,t);(a=r.start)==null||a.call(r,o),r.connect(ye()),N[e]=r}return N[e].delayTime.value!==n&&N[e].delayTime.setValueAtTime(n,o),N[e].feedback.value!==t&&N[e].feedback.setValueAtTime(t,o),N[e]}const M={};function Kt(e,n,t=1,o=.5,a=1e3,r=2e3){const i=I(),c=i.createGain();c.gain.value=r,M[e]==null&&(M[e]=i.createOscillator(),M[e].frequency.value=t,M[e].type="sine",M[e].start()),M[e].connect(c),M[e].frequency.value!=t&&M[e].frequency.setValueAtTime(t,n);const s=2;let l=0;const u=[];for(let g=0;g<s;g++){const d=i.createBiquadFilter();d.type="notch",d.gain.value=1,d.frequency.value=a+l,d.Q.value=2-Math.min(Math.max(o*2,0),1.9),c.connect(d.detune),l+=282,g>0&&u[g-1].connect(d),u.push(d)}return u[u.length-1]}let Z={},$=(e,n)=>e!==void 0&&e!==n;function Ft(e,n,t,o,a,r){if(!Z[e]){const i=I().createReverb(n,t,o,a,r);i.connect(ye()),Z[e]=i}return($(n,Z[e].duration)||$(t,Z[e].fade)||$(o,Z[e].lp)||$(a,Z[e].dim)||Z[e].ir!==r)&&Z[e].generate(n,t,o,a,r),Z[e]}let k;function Yt(e=2048){if(!k){const n=I().createAnalyser();n.fftSize=e,k=n,new Float32Array(k.frequencyBinCount)}return k.fftSize!==e&&(k.fftSize=e,new Float32Array(k.frequencyBinCount)),k}function ge(e,n,t){const o=ee(t);return e.connect(o),o.connect(n),o}const zt=async(e,n,t)=>{const o=I();if(typeof e!="object")throw new Error(`expected hap.value to be an object, but got "${e}". Hint: append .note() or .s() to the end`,"error");e.duration=t;let a=o.currentTime+n,{s:r="triangle",bank:i,source:c,gain:s=.8,postgain:l=1,ftype:u="12db",fanchor:g=.5,cutoff:d,lpenv:f,lpattack:p=.01,lpdecay:m=.01,lpsustain:v=1,lprelease:C=.01,resonance:X=1,hpenv:w,hcutoff:G,hpattack:R=.01,hpdecay:A=.01,hpsustain:z=1,hprelease:D=.01,hresonance:J=1,bpenv:S,bandf:b,bpattack:T=.01,bpdecay:j=.01,bpsustain:O=1,bprelease:te=.01,bandq:x=1,phaser:Q,phaserdepth:V=.75,phasersweep:ne,phasercenter:L,coarse:E,crush:Be,shape:we,pan:Ge,vowel:Re,delay:Ve=0,delayfeedback:Xe=.5,delaytime:Te=.25,orbit:oe=1,room:Ze,roomfade:Ue,roomlp:$e,roomdim:_e,roomsize:et,ir:ae,i:He=0,velocity:tt=1,analyze:Me,fft:nt=8,compressor:We,compressorRatio:ot,compressorKnee:at,compressorAttack:rt,compressorRelease:ct}=e;s*=tt;let Ne=[];const it=()=>{Ne.forEach(h=>h==null?void 0:h.disconnect())};i&&r&&(r=`${i}_${r}`);let P;if(c)P=c(a,e,t);else if(se(r)){const{onTrigger:h}=se(r),W=await h(a,e,it);W&&(P=W.node,W.stop(a+t))}else throw new Error(`sound ${r} not found! Is it loaded?`);if(!P)return;if(o.currentTime>a){Y("[webaudio] skip hap: still loading",o.currentTime-a);return}const y=[];if(y.push(P),y.push(ee(s)),d!==void 0){let h=()=>ce(o,"lowpass",d,X,p,m,v,C,f,a,a+t,g);y.push(h()),u==="24db"&&y.push(h())}if(G!==void 0){let h=()=>ce(o,"highpass",G,J,R,A,z,D,w,a,a+t,g);y.push(h()),u==="24db"&&y.push(h())}if(b!==void 0){let h=()=>ce(o,"bandpass",b,x,T,j,O,te,S,a,a+t,g);y.push(h()),u==="24db"&&y.push(h())}if(Re!==void 0){const h=o.createVowelFilter(Re);y.push(h)}if(E!==void 0&&y.push(de(o,"coarse-processor",{coarse:E})),Be!==void 0&&y.push(de(o,"crush-processor",{crush:Be})),we!==void 0&&y.push(de(o,"shape-processor",{shape:we})),We!==void 0&&y.push(vt(o,We,ot,at,rt,ct)),Ge!==void 0){const h=o.createStereoPanner();h.pan.value=2*Ge-1,y.push(h)}if(Q!==void 0&&V>0){const h=Kt(oe,a,Q,V,L,ne);y.push(h)}const q=ee(l);y.push(q),q.connect(ye());let ke;if(Ve>0&&Te>0&&Xe>0){const h=kt(oe,Te,Xe,a);ke=ge(q,h,Ve)}let Ke;if(Ze>0){let h;if(ae!==void 0){let re,K=se(ae);Array.isArray(K)?re=K.data.samples[He%K.data.samples.length]:typeof K=="object"&&(re=Object.values(K.data.samples).flat()[He%Object.values(K.data.samples).length]),h=await xe(re,o,ae,0)}const W=Ft(oe,et,Ue,$e,_e,h);Ke=ge(q,W,Ze)}let Fe;if(Me){const h=Yt(2**(nt+5));Fe=ge(q,h,Me)}y.slice(1).reduce((h,W)=>h.connect(W),y[0]),Ne=y.concat([ke,Ke,Fe])};let fe={};function Dt(e){const n=I();if(fe[e])return fe[e];const t=2*n.sampleRate,o=n.createBuffer(1,t,n.sampleRate),a=o.getChannelData(0);let r=0,i,c,s,l,u,g,d;i=c=s=l=u=g=d=0;for(let f=0;f<t;f++)if(e==="white")a[f]=Math.random()*2-1;else if(e==="brown"){let p=Math.random()*2-1;a[f]=(r+.02*p)/1.02,r=a[f]}else if(e==="pink"){let p=Math.random()*2-1;i=.99886*i+p*.0555179,c=.99332*c+p*.0750759,s=.969*s+p*.153852,l=.8665*l+p*.3104856,u=.55*u+p*.5329522,g=-.7616*g-p*.016898,a[f]=i+c+s+l+u+g+d+p*.5362,a[f]*=.11,d=p*.115926}return fe[e]=o,o}function Je(e="white",n){const t=I().createBufferSource();return t.buffer=Dt(e),t.loop=!0,t.start(n),{node:t,stop:o=>t.stop(o)}}function St(e,n,t){const o=Je("pink",t);return{node:Bt(e,o.node,n),stop:a=>o==null?void 0:o.stop(a)}}const jt=(e,n=1,t="sine")=>{const o=I(),a=o.createOscillator();a.type=t,a.frequency.value=e,a.start();const r=new GainNode(o,{gain:n});return a.connect(r),{node:r,stop:i=>a.stop(i)}},Ot=(e,n,t,o="sine")=>{const a=e.frequency.value*n,r=a*t;return jt(a,r,o)},Se=["sine","square","triangle","sawtooth"],xt=["pink","white","brown"];function Qt(){[...Se,...xt].forEach(e=>{qe(e,(n,t,o)=>{let{attack:a=.001,decay:r=.05,sustain:i=.6,release:c=.01}=t,s;Se.includes(e)?s=qt(e,n,t):s=Je(e,n);let{node:l,stop:u,triggerRelease:g}=s;const d=ee(.3),{node:f,stop:p}=Ce(a,r,i,c,1,n);return l.onended=()=>{l.disconnect(),d.disconnect(),o()},{node:l.connect(d).connect(f),stop:m=>{p(m),g==null||g(m);let v=m+c;u(v)}}},{type:"synth",prebake:!0})})}function Lt(e,n){const t=new Float32Array(e+1),o=new Float32Array(e+1),a=I(),r=a.createOscillator(),i={sawtooth:l=>[0,-1/l],square:l=>[0,l%2===0?0:1/l],triangle:l=>[l%2===0?0:1/(l*l),0]};if(!i[n])throw new Error(`unknown wave type ${n}`);t[0]=0,o[0]=0;let c=1;for(;c<=e;){const[l,u]=i[n](c);t[c]=l,o[c]=u,c++}const s=a.createPeriodicWave(t,o);return r.setPeriodicWave(s),r}function qt(e,n,{n:t,note:o,freq:a,vib:r=0,vibmod:i=.5,noise:c=0,fmh:s=1,fmi:l,fmenv:u="lin",fmattack:g,fmdecay:d,fmsustain:f,fmrelease:p,fmvelocity:m,fmwave:v="sine"}){I();let C;!t||e==="sine"?(C=I().createOscillator(),C.type=e||"triangle"):C=Lt(t,e),o=o||36,typeof o=="string"&&(o=me(o)),!a&&typeof o=="number"&&(a=It(o)),C.frequency.value=Number(a),C.start(n);let X,w;if(l){const{node:A,stop:z}=Ot(C,s,l,v);[g,d,f,p,m].find(D=>D!==void 0)?(g=g??.001,d=d??.001,f=f??1,p=p??.001,m=m??1,w=Ce(g,d,f,p,m,n),u==="exp"&&(w=yt(g,d,f,p,m,n),w.node.maxValue=l*2,w.node.minValue=1e-5),A.connect(w.node),w.node.connect(C.frequency)):A.connect(C.frequency),X=z}let G;if(r>0){G=I().createOscillator(),G.frequency.value=r;const A=I().createGain();A.gain.value=i*100,G.connect(A),A.connect(C.detune),G.start(n)}let R;return c&&(R=St(C,c,n)),{node:(R==null?void 0:R.node)||C,stop:A=>{G==null||G.stop(A),R==null||R.stop(A),X==null||X(A),C.stop(A)},triggerRelease:A=>{w==null||w.stop(A)}}}let pe;const Jt=()=>{};typeof window<"u"&&window.addEventListener("message",e=>{var n;e.data==="strudel-stop"?Jt():(n=e.data)!=null&&n.dough&&(pe==null||pe.node.port.postMessage(e.data))});AudioContext.prototype.createClock=function(e,n,t=.1,o=.1){let a=0,r=0,i=10**4,c=.01;const s=f=>n=f(n);o=o||t/2;const l=()=>{const f=this.currentTime,p=f+t+o;for(r===0&&(r=f+c);r<p;)r=Math.round(r*i)/i,r>=f&&e(r,n,a),r+=n,a++};let u;const g=()=>{l(),u=setInterval(l,t*1e3)},d=()=>clearInterval(u);return{setDuration:s,start:g,stop:()=>{a=0,r=0,d()},pause:()=>d(),duration:n}};const Et=Promise.all([Nt({disableWorklets:!0}),Qe("github:tidalcycles/Dirt-Samples/master"),Qt()]),Ae=1/48,je=1/Ae;console.log("hello");const H={};Object.assign(window,{p(e){const{duration:n=.25,nudge:t=0,...o}=e;return zt(o,H.deadline+t,n)},pulse:e=>H.tick%e===0,beat:(e,n=0)=>(Array.isArray(e)?e:[e]).some(t=>!((H.tick-n*je)%Math.floor(t*je))),bpm:e=>{F.setDuration(()=>Ae*60/e)}});let Pt=`
bpm(93)

function tick() {
  beat(.5) && p({s:"hh"})
  beat(1) && p({s:"bd"})
  beat(2) && p({s:"sd"})
  beat([.75,1],.5) && p({s:"jvbass",delay:.25})
  beat(1,.5) 
  && p({note:"f#",room:1},.25) 
  && p({note:"a",room:1},.15)
}
`.trim();const Oe=window.location.href.split("#")[1]||"";let _=Oe?tn(Oe):Pt;function Ut(e){const n=`"use strict"; ${e}; return tick`;return Function(n).call(H)}let F,Ie;function $t(){if(F)return F;F=I().createClock((e,n,t)=>{H.deadline=e-I().currentTime,H.tick=t;try{H.ticker&&H.ticker()}catch(o){console.error(o)}},Ae)}async function Ee(){await Et,$t(),await _t(),Ie||(F.start(),Ie=!0)}function Pe(){F.stop(),Ie=!1}const ve=document.getElementById("code");async function _t(){_=ve.value,H.ticker=Ut(_),window.location.hash=btoa(_)}ve.innerHTML=_;ve.addEventListener("keydown",e=>{e.ctrlKey&&e.key==="Enter"&&Ee(),e.ctrlKey&&e.key==="."&&Pe()});document.getElementById("play").addEventListener("click",()=>Ee());document.getElementById("stop").addEventListener("click",()=>Pe());function en(e){const n=new Uint8Array(atob(e).split("").map(o=>o.charCodeAt(0)));return new TextDecoder().decode(n)}function tn(e){return en(decodeURIComponent(e))}
