(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))o(a);new MutationObserver(a=>{for(const c of a)if(c.type==="childList")for(const s of c.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&o(s)}).observe(document,{childList:!0,subtree:!0});function n(a){const c={};return a.integrity&&(c.integrity=a.integrity),a.referrerPolicy&&(c.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?c.credentials="include":a.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function o(a){if(a.ep)return;a.ep=!0;const c=n(a);fetch(a.href,c)}})();let w=[],ut=(e,t)=>{let n,o=[],a={lc:0,l:t||0,value:e,set(c){a.value=c,a.notify()},get(){return a.lc||a.listen(()=>{})(),a.value},notify(c){n=o;let s=!w.length;for(let i=0;i<n.length;i+=2)w.push(n[i],a.value,c,n[i+1]);if(s){for(let i=0;i<w.length;i+=4){let l=!1;for(let u=i+7;u<w.length;u+=4)if(w[u]<w[i+3]){l=!0;break}l?w.push(w[i],w[i+1],w[i+2],w[i+3]):w[i](w[i+1],w[i+2])}w.length=0}},listen(c,s){return o===n&&(o=o.slice()),a.lc=o.push(c,s||a.l)/2,()=>{o===n&&(o=o.slice());let i=o.indexOf(c);~i&&(o.splice(i,2),a.lc--,a.lc||a.off())}},subscribe(c,s){let i=a.listen(c,s);return c(a.value),i},off(){}};return a},dt=(e={})=>{let t=ut(e);return t.setKey=function(n,o){typeof o>"u"?n in t.value&&(t.value={...t.value},delete t.value[n],t.notify(n)):t.value[n]!==o&&(t.value={...t.value,[n]:o},t.notify(n))},t};if(typeof DelayNode<"u"){class e extends DelayNode{constructor(n,o,a,c){super(n),o=Math.abs(o),this.delayTime.value=a;const s=n.createGain();s.gain.value=Math.min(Math.abs(c),.995),this.feedback=s.gain;const i=n.createGain();return i.gain.value=o,this.delayGain=i,this.connect(s),this.connect(i),s.connect(this),this.connect=l=>i.connect(l),this}start(n){this.delayGain.gain.setValueAtTime(this.delayGain.gain.value,n+this.delayTime.value)}}AudioContext.prototype.createFeedbackDelay=function(t,n,o){return new e(this,t,n,o)}}var ye={};ye.generateReverb=function(e,t){for(var n=e.audioContext||new AudioContext,o=n.sampleRate,a=e.numChannels||2,c=e.decayTime*1.5,s=Math.round(e.decayTime*o),i=Math.round(c*o),l=Math.round((e.fadeInTime||0)*o),u=Math.pow(1/1e3,1/s),d=n.createBuffer(a,i,o),g=0;g<a;g++){for(var f=d.getChannelData(g),p=0;p<i;p++)f[p]=pt()*Math.pow(u,p);for(var p=0;p<l;p++)f[p]*=p/l}gt(d,e.lpFreqStart||0,e.lpFreqEnd||0,e.decayTime,t)};ye.generateGraph=function(e,t,n,o,a){var c=document.createElement("canvas");c.width=t,c.height=n;var s=c.getContext("2d");s.fillStyle="#000",s.fillRect(0,0,c.width,c.height),s.fillStyle="#fff";for(var i=t/e.length,l=n/(a-o),u=0;u<e.length;u++)s.fillRect(u*i,n-(e[u]-o)*l,1,1);return c};var gt=function(e,t,n,o,a){if(t==0){a(e);return}var c=ft(e),s=new OfflineAudioContext(e.numberOfChannels,c[0].length,e.sampleRate),i=s.createBufferSource();i.buffer=e;var l=s.createBiquadFilter();t=Math.min(t,e.sampleRate/2),n=Math.min(n,e.sampleRate/2),l.type="lowpass",l.Q.value=1e-4,l.frequency.setValueAtTime(t,0),l.frequency.linearRampToValueAtTime(n,o),i.connect(l),l.connect(s.destination),i.start(),s.oncomplete=function(u){a(u.renderedBuffer)},s.startRendering(),window.filterNode=l},ft=function(e){for(var t=[],n=0;n<e.numberOfChannels;n++)t[n]=e.getChannelData(n);return t},pt=function(){return Math.random()*2-1};typeof AudioContext<"u"&&(AudioContext.prototype.adjustLength=function(e,t){const n=t.sampleRate*e,o=this.createBuffer(t.numberOfChannels,t.length,t.sampleRate);for(let a=0;a<t.numberOfChannels;a++){let c=t.getChannelData(a),s=o.getChannelData(a);for(let i=0;i<n;i++)s[i]=c[i]||0}return o},AudioContext.prototype.createReverb=function(e,t,n,o,a){const c=this.createConvolver();return c.generate=(s=2,i=.1,l=15e3,u=1e3,d)=>{c.duration=s,c.fade=i,c.lp=l,c.dim=u,c.ir=d,d?c.buffer=this.adjustLength(s,d):ye.generateReverb({audioContext:this,numChannels:2,decayTime:s,fadeInTime:i,lpFreqStart:l,lpFreqEnd:u},g=>{c.buffer=g})},c.generate(e,t,n,o,a),c});var xe={a:{freqs:[660,1120,2750,3e3,3350],gains:[1,.5012,.0708,.0631,.0126],qs:[80,90,120,130,140]},e:{freqs:[440,1800,2700,3e3,3300],gains:[1,.1995,.1259,.1,.1],qs:[70,80,100,120,120]},i:{freqs:[270,1850,2900,3350,3590],gains:[1,.0631,.0631,.0158,.0158],qs:[40,90,100,120,120]},o:{freqs:[430,820,2700,3e3,3300],gains:[1,.3162,.0501,.0794,.01995],qs:[40,80,100,120,120]},u:{freqs:[370,630,2750,3e3,3400],gains:[1,.1,.0708,.0316,.01995],qs:[40,60,100,120,120]}};if(typeof GainNode<"u"){class e extends GainNode{constructor(n,o){if(super(n),!xe[o])throw new Error("vowel: unknown vowel "+o);const{gains:a,qs:c,freqs:s}=xe[o],i=n.createGain();for(let l=0;l<5;l++){const u=n.createGain();u.gain.value=a[l];const d=n.createBiquadFilter();d.type="bandpass",d.Q.value=c[l],d.frequency.value=s[l],this.connect(d),d.connect(u),u.connect(i)}return i.gain.value=8,this.connect=l=>i.connect(l),this}}AudioContext.prototype.createVowelFilter=function(t){return new e(this,t)}}const ht=e=>{var a;if(typeof e!="string")return[];const[t,n="",o]=((a=e.match(/^([a-gA-G])([#bsf]*)([0-9]*)$/))==null?void 0:a.slice(1))||[];return t?[t,n,o?Number(o):void 0]:[]},It={c:0,d:2,e:4,f:5,g:7,a:9,b:11},bt={"#":1,b:-1,s:1,f:-1},Ae=(e,t=3)=>{const[n,o,a=t]=ht(e);if(!n)throw new Error('not a note: "'+e+'"');const c=It[n.toLowerCase()],s=(o==null?void 0:o.split("").reduce((i,l)=>i+bt[l],0))||0;return(Number(a)+1)*12+c+s},mt=e=>Math.pow(2,(e-69)/12)*440,me=(e,t,n)=>Math.min(Math.max(e,t),n),Ct=e=>12*Math.log(e/440)/Math.LN2+69,yt=(e,t)=>{if(typeof e!="object")throw new Error("valueToMidi: expected object value");let{freq:n,note:o}=e;if(typeof n=="number")return Ct(n);if(typeof o=="string")return Ae(o);if(typeof o=="number")return o;if(!t)throw new Error("valueToMidi: expected freq or note to be set");return t},At="data:application/javascript;base64,Ly8gTElDRU5TRSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSB2My4wIHNlZSBodHRwczovL2dpdGh1Yi5jb20vZGt0cjAvV2ViRGlydC9ibG9iL21haW4vTElDRU5TRQovLyBhbGwgdGhlIGNyZWRpdCBnb2VzIHRvIGRrdHIwJ3Mgd2ViZGlydDogaHR0cHM6Ly9naXRodWIuY29tL2RrdHIwL1dlYkRpcnQvYmxvYi81Y2UzZDY5ODM2MmM1NGQ2ZTFiNjhhY2M0N2ViMjk1NWFjNjJjNzkzL2Rpc3QvQXVkaW9Xb3JrbGV0cy5qcwovLyA8MwoKY2xhc3MgQ29hcnNlUHJvY2Vzc29yIGV4dGVuZHMgQXVkaW9Xb3JrbGV0UHJvY2Vzc29yIHsKICBzdGF0aWMgZ2V0IHBhcmFtZXRlckRlc2NyaXB0b3JzKCkgewogICAgcmV0dXJuIFt7IG5hbWU6ICdjb2Fyc2UnLCBkZWZhdWx0VmFsdWU6IDEgfV07CiAgfQoKICBjb25zdHJ1Y3RvcigpIHsKICAgIHN1cGVyKCk7CiAgICB0aGlzLm5vdFN0YXJ0ZWQgPSB0cnVlOwogIH0KCiAgcHJvY2VzcyhpbnB1dHMsIG91dHB1dHMsIHBhcmFtZXRlcnMpIHsKICAgIGNvbnN0IGlucHV0ID0gaW5wdXRzWzBdOwogICAgY29uc3Qgb3V0cHV0ID0gb3V0cHV0c1swXTsKICAgIGNvbnN0IGNvYXJzZSA9IHBhcmFtZXRlcnMuY29hcnNlOwogICAgY29uc3QgYmxvY2tTaXplID0gMTI4OwogICAgY29uc3QgaGFzSW5wdXQgPSAhKGlucHV0WzBdID09PSB1bmRlZmluZWQpOwogICAgaWYgKGhhc0lucHV0KSB7CiAgICAgIHRoaXMubm90U3RhcnRlZCA9IGZhbHNlOwogICAgICBvdXRwdXRbMF1bMF0gPSBpbnB1dFswXVswXTsKICAgICAgZm9yIChsZXQgbiA9IDE7IG4gPCBibG9ja1NpemU7IG4rKykgewogICAgICAgIGZvciAobGV0IG8gPSAwOyBvIDwgb3V0cHV0Lmxlbmd0aDsgbysrKSB7CiAgICAgICAgICBvdXRwdXRbb11bbl0gPSBuICUgY29hcnNlID09IDAgPyBpbnB1dFswXVtuXSA6IG91dHB1dFtvXVtuIC0gMV07CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICByZXR1cm4gdGhpcy5ub3RTdGFydGVkIHx8IGhhc0lucHV0OwogIH0KfQoKcmVnaXN0ZXJQcm9jZXNzb3IoJ2NvYXJzZS1wcm9jZXNzb3InLCBDb2Fyc2VQcm9jZXNzb3IpOwoKY2xhc3MgQ3J1c2hQcm9jZXNzb3IgZXh0ZW5kcyBBdWRpb1dvcmtsZXRQcm9jZXNzb3IgewogIHN0YXRpYyBnZXQgcGFyYW1ldGVyRGVzY3JpcHRvcnMoKSB7CiAgICByZXR1cm4gW3sgbmFtZTogJ2NydXNoJywgZGVmYXVsdFZhbHVlOiAwIH1dOwogIH0KCiAgY29uc3RydWN0b3IoKSB7CiAgICBzdXBlcigpOwogICAgdGhpcy5ub3RTdGFydGVkID0gdHJ1ZTsKICB9CgogIHByb2Nlc3MoaW5wdXRzLCBvdXRwdXRzLCBwYXJhbWV0ZXJzKSB7CiAgICBjb25zdCBpbnB1dCA9IGlucHV0c1swXTsKICAgIGNvbnN0IG91dHB1dCA9IG91dHB1dHNbMF07CiAgICBjb25zdCBjcnVzaCA9IHBhcmFtZXRlcnMuY3J1c2g7CiAgICBjb25zdCBibG9ja1NpemUgPSAxMjg7CiAgICBjb25zdCBoYXNJbnB1dCA9ICEoaW5wdXRbMF0gPT09IHVuZGVmaW5lZCk7CiAgICBpZiAoaGFzSW5wdXQpIHsKICAgICAgdGhpcy5ub3RTdGFydGVkID0gZmFsc2U7CiAgICAgIGlmIChjcnVzaC5sZW5ndGggPT09IDEpIHsKICAgICAgICBjb25zdCB4ID0gTWF0aC5wb3coMiwgY3J1c2hbMF0gLSAxKTsKICAgICAgICBmb3IgKGxldCBuID0gMDsgbiA8IGJsb2NrU2l6ZTsgbisrKSB7CiAgICAgICAgICBjb25zdCB2YWx1ZSA9IE1hdGgucm91bmQoaW5wdXRbMF1bbl0gKiB4KSAvIHg7CiAgICAgICAgICBmb3IgKGxldCBvID0gMDsgbyA8IG91dHB1dC5sZW5ndGg7IG8rKykgewogICAgICAgICAgICBvdXRwdXRbb11bbl0gPSB2YWx1ZTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZm9yIChsZXQgbiA9IDA7IG4gPCBibG9ja1NpemU7IG4rKykgewogICAgICAgICAgbGV0IHggPSBNYXRoLnBvdygyLCBjcnVzaFtuXSAtIDEpOwogICAgICAgICAgY29uc3QgdmFsdWUgPSBNYXRoLnJvdW5kKGlucHV0WzBdW25dICogeCkgLyB4OwogICAgICAgICAgZm9yIChsZXQgbyA9IDA7IG8gPCBvdXRwdXQubGVuZ3RoOyBvKyspIHsKICAgICAgICAgICAgb3V0cHV0W29dW25dID0gdmFsdWU7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICByZXR1cm4gdGhpcy5ub3RTdGFydGVkIHx8IGhhc0lucHV0OwogIH0KfQpyZWdpc3RlclByb2Nlc3NvcignY3J1c2gtcHJvY2Vzc29yJywgQ3J1c2hQcm9jZXNzb3IpOwoKY2xhc3MgU2hhcGVQcm9jZXNzb3IgZXh0ZW5kcyBBdWRpb1dvcmtsZXRQcm9jZXNzb3IgewogIHN0YXRpYyBnZXQgcGFyYW1ldGVyRGVzY3JpcHRvcnMoKSB7CiAgICByZXR1cm4gW3sgbmFtZTogJ3NoYXBlJywgZGVmYXVsdFZhbHVlOiAwIH1dOwogIH0KCiAgY29uc3RydWN0b3IoKSB7CiAgICBzdXBlcigpOwogICAgdGhpcy5ub3RTdGFydGVkID0gdHJ1ZTsKICB9CgogIHByb2Nlc3MoaW5wdXRzLCBvdXRwdXRzLCBwYXJhbWV0ZXJzKSB7CiAgICBjb25zdCBpbnB1dCA9IGlucHV0c1swXTsKICAgIGNvbnN0IG91dHB1dCA9IG91dHB1dHNbMF07CiAgICBjb25zdCBzaGFwZTAgPSBwYXJhbWV0ZXJzLnNoYXBlWzBdOwogICAgY29uc3Qgc2hhcGUxID0gc2hhcGUwIDwgMSA/IHNoYXBlMCA6IDEuMCAtIDRlLTEwOwogICAgY29uc3Qgc2hhcGUgPSAoMi4wICogc2hhcGUxKSAvICgxLjAgLSBzaGFwZTEpOwogICAgY29uc3QgYmxvY2tTaXplID0gMTI4OwogICAgY29uc3QgaGFzSW5wdXQgPSAhKGlucHV0WzBdID09PSB1bmRlZmluZWQpOwogICAgaWYgKGhhc0lucHV0KSB7CiAgICAgIHRoaXMubm90U3RhcnRlZCA9IGZhbHNlOwogICAgICBmb3IgKGxldCBuID0gMDsgbiA8IGJsb2NrU2l6ZTsgbisrKSB7CiAgICAgICAgY29uc3QgdmFsdWUgPSAoKDEgKyBzaGFwZSkgKiBpbnB1dFswXVtuXSkgLyAoMSArIHNoYXBlICogTWF0aC5hYnMoaW5wdXRbMF1bbl0pKTsKICAgICAgICBmb3IgKGxldCBvID0gMDsgbyA8IG91dHB1dC5sZW5ndGg7IG8rKykgewogICAgICAgICAgb3V0cHV0W29dW25dID0gdmFsdWU7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICByZXR1cm4gdGhpcy5ub3RTdGFydGVkIHx8IGhhc0lucHV0OwogIH0KfQoKcmVnaXN0ZXJQcm9jZXNzb3IoJ3NoYXBlLXByb2Nlc3NvcicsIFNoYXBlUHJvY2Vzc29yKTsK";function te(e){const t=b().createGain();return t.gain.value=e,t}const ve=(e,t,n,o,a,c)=>{const s=b().createGain();return s.gain.setValueAtTime(0,c),s.gain.linearRampToValueAtTime(a,c+e),s.gain.linearRampToValueAtTime(n*a,c+e+t),{node:s,stop:i=>{s.gain.setValueAtTime(n*a,i),s.gain.linearRampToValueAtTime(0,i+o)}}},vt=(e,t,n,o,a,c)=>{n=Math.max(.001,n),a=Math.max(.001,a);const s=b().createGain();return s.gain.setValueAtTime(1e-4,c),s.gain.exponentialRampToValueAtTime(a,c+e),s.gain.exponentialRampToValueAtTime(n*a,c+e+t),{node:s,stop:i=>{s.gain.exponentialRampToValueAtTime(1e-4,i+o)}}},Bt=(e,t,n,o,a,c,s,i,l)=>{const u=s-c,d=c+u,g=c+o*u;e.setValueAtTime(c,i),e.linearRampToValueAtTime(d,i+t),e.linearRampToValueAtTime(g,i+t+n),e.setValueAtTime(g,l),e.linearRampToValueAtTime(c,l+Math.max(a,.1))};function wt(e,t,n,o,a,c){const s={threshold:t??-3,ratio:n??10,knee:o??10,attack:a??.005,release:c??.05};return new DynamicsCompressorNode(e,s)}function se(e,t,n,o,a,c,s,i,l,u,d,g=.5){const f=e.createBiquadFilter();if(f.type=t,f.Q.value=o,f.frequency.value=n,!isNaN(l)&&l!==0){const p=l*g,h=me(2**-p*n,0,2e4),C=me(2**(l-p)*n,0,2e4);return Bt(f.frequency,a,c,s,i,h,C,u,d),f}return f}let Se=e=>e<.5?1:1-(e-.5)/.5;function Gt(e,t,n=0){const o=b();if(!n)return e;let a=o.createGain(),c=o.createGain();e.connect(a),t.connect(c),a.gain.value=Se(n),c.gain.value=Se(1-n);let s=o.createGain();return a.connect(s),c.connect(s),s}let Rt=e=>console.log(e);const z=(...e)=>Rt(...e),le={};function Vt(e,t){var n=t?1e3:1024;if(e<n)return e+" B";var o=t?["kB","MB","GB","TB","PB","EB","ZB","YB"]:["KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"],a=-1;do e/=n,++a;while(e>=n);return e.toFixed(1)+" "+o[a]}const Xt=async(e,t,n,o,a,c,s)=>{let i=0;a!==void 0&&n!==void 0&&z("[sampler] hap has note and freq. ignoring note","warning");let l=yt({freq:a,note:n},36);i=l-36;const u=b();let d;if(Array.isArray(c))d=c[t%c.length];else{const h=B=>Ae(B)-l,C=Object.keys(c).filter(B=>!B.startsWith("_")).reduce((B,y,M)=>!B||Math.abs(h(y))<Math.abs(h(B))?y:B,null);i=-h(C),d=c[C][t%c[C].length]}s&&(d=await s(d));let g=await qe(d,u,e,t);o<0&&(g=Tt(g));const f=u.createBufferSource();f.buffer=g;const p=1*Math.pow(2,i/12);return f.playbackRate.value=p,f},qe=(e,t,n,o=0)=>{const a=n?`sound "${n}:${o}"`:"sample";if(e=e.replace("#","%23"),!le[e]){z(`[sampler] load ${a}..`,"load-sample",{url:e});const c=Date.now();le[e]=fetch(e).then(s=>s.arrayBuffer()).then(async s=>{const i=Date.now()-c,l=Vt(s.byteLength);return z(`[sampler] load ${a}... done! loaded ${l} in ${i}ms`,"loaded-sample",{url:e}),await t.decodeAudioData(s)})}return le[e]};function Tt(e){const t=b(),n=t.createBuffer(e.numberOfChannels,e.length,t.sampleRate);for(let o=0;o<e.numberOfChannels;o++)n.copyToChannel(e.getChannelData(o).slice().reverse(),o,o);return n}const Mt=(e,t,n=e._base||"")=>Object.entries(e).forEach(([o,a])=>{if(typeof a=="string"&&(a=[a]),typeof a!="object")throw new Error("wrong sample map format for "+o);n=a._base||n;const c=s=>(n+s).replace("github:","https://raw.githubusercontent.com/");Array.isArray(a)?a=a.map(c):a=Object.fromEntries(Object.entries(a).map(([s,i])=>[s,(typeof i=="string"?[i]:i).map(c)])),t(o,a)});let Zt={};function Ht(e){const t=Object.entries(Zt).find(([n])=>e.startsWith(n));if(t)return t[1]}const Be=async(e,t=e._base||"",n={})=>{if(typeof e=="string"){const c=Ht(e);if(c)return c(e);if(e.startsWith("bubo:")){const[i,l]=e.split(":");e=`github:Bubobubobubobubo/dough-${l}`}if(e.startsWith("github:")){let[i,l]=e.split("github:");l=l.endsWith("/")?l.slice(0,-1):l,l.split("/").length===2&&(l+="/main"),e=`https://raw.githubusercontent.com/${l}/strudel.json`}if(e.startsWith("shabda:")){let[i,l]=e.split("shabda:");e=`https://shabda.ndre.gr/${l}.json?strudel=1`}if(e.startsWith("shabda/speech")){let[i,l]=e.split("shabda/speech");l=l.startsWith("/")?l.substring(1):l;let[u,d]=l.split(":"),g="f",f="en-GB";u&&([f,g]=u.split("/")),e=`https://shabda.ndre.gr/speech/${d}.json?gender=${g}&language=${f}&strudel=1'`}if(typeof fetch!="function")return;const s=e.split("/").slice(0,-1).join("/");return typeof fetch>"u"?void 0:fetch(e).then(i=>i.json()).then(i=>Be(i,t||i._base||s,n)).catch(i=>{throw console.error(i),new Error(`error loading "${e}"`)})}const{prebake:o,tag:a}=n;Mt(e,(c,s)=>Ee(c,(i,l,u)=>Wt(i,l,u,s),{type:"sample",samples:s,baseUrl:t,prebake:o,tag:a}),t)},je=[];async function Wt(e,t,n,o,a){let{s:c,freq:s,unit:i,nudge:l=0,cut:u,loop:d,clip:g=void 0,n:f=0,note:p,speed:h=1,loopBegin:C=0,begin:B=0,loopEnd:y=1,end:M=1,vib:G,vibmod:R=.5}=t;if(h===0)return;d=c.startsWith("wt_")?1:t.loop;const V=b(),{attack:v=.001,decay:D=.001,sustain:x=1,release:E=.001}=t,S=e+l,m=await Xt(c,f,p,h,s,o,a);let Z;if(G>0){Z=b().createOscillator(),Z.frequency.value=G;const X=b().createGain();X.gain.value=R*100,Z.connect(X),X.connect(m.detune),Z.start(0)}if(V.currentTime>e){z(`[sampler] still loading sound "${c}:${f}"`,"highlight");return}if(!m){z(`[sampler] could not load "${c}:${f}"`,"error");return}m.playbackRate.value=Math.abs(h)*m.playbackRate.value,i==="c"&&(m.playbackRate.value=m.playbackRate.value*m.buffer.duration*1);const j=B*m.buffer.duration;d&&(m.loop=!0,m.loopStart=C*m.buffer.duration-j,m.loopEnd=y*m.buffer.duration-j),m.start(S,j);const{node:O,stop:oe}=ve(v,D,x,E,1,e);m.connect(O);const Q=V.createGain();O.connect(Q),m.onended=function(){m.disconnect(),Z==null||Z.stop(),O.disconnect(),Q.disconnect(),n()};const L={node:Q,bufferSource:m,stop:(X,ae=g===void 0&&d===void 0)=>{let q=X;if(ae){const P=m.buffer.duration/m.playbackRate.value;q=e+(M-B)*P}m.stop(q+E),oe(q)}};if(u!==void 0){const X=je[u];X&&(X.node.gain.setValueAtTime(1,S),X.node.gain.linearRampToValueAtTime(0,S+.01)),je[u]=L}return L}const Je=dt();function Ee(e,t,n={}){Je.setKey(e,{onTrigger:t,data:n})}function ue(e){return Je.get()[e]}let de;const b=()=>(de||(de=new AudioContext),de);let $;const we=()=>{const e=b();return $||($=e.createGain(),$.connect(e.destination)),$};let ge;function Nt(){return ge||(ge=b().audioWorklet.addModule(At),ge)}function fe(e,t,n){const o=new AudioWorkletNode(e,t);return Object.entries(n).forEach(([a,c])=>{o.parameters.get(a).value=c}),o}async function kt(e={}){const{disableWorklets:t=!1}=e;typeof window<"u"&&(await b().resume(),t?console.log("disableWorklets: AudioWorklet effects coarse, crush and shape are skipped!"):await Nt().catch(n=>{console.warn("could not load AudioWorklet effects coarse, crush and shape",n)}))}async function Kt(e){return new Promise(t=>{document.addEventListener("click",async function n(){await kt(e),t(),document.removeEventListener("click",n)})})}let k={};function Ft(e,t,n,o){var a;if(n=me(n,0,.98),!k[e]){const c=b().createFeedbackDelay(1,t,n);(a=c.start)==null||a.call(c,o),c.connect(we()),k[e]=c}return k[e].delayTime.value!==t&&k[e].delayTime.setValueAtTime(t,o),k[e].feedback.value!==n&&k[e].feedback.setValueAtTime(n,o),k[e]}const W={};function Yt(e,t,n=1,o=.5,a=1e3,c=2e3){const s=b(),i=s.createGain();i.gain.value=c,W[e]==null&&(W[e]=s.createOscillator(),W[e].frequency.value=n,W[e].type="sine",W[e].start()),W[e].connect(i),W[e].frequency.value!=n&&W[e].frequency.setValueAtTime(n,t);const l=2;let u=0;const d=[];for(let g=0;g<l;g++){const f=s.createBiquadFilter();f.type="notch",f.gain.value=1,f.frequency.value=a+u,f.Q.value=2-Math.min(Math.max(o*2,0),1.9),i.connect(f.detune),u+=282,g>0&&d[g-1].connect(f),d.push(f)}return d[d.length-1]}let H={},_=(e,t)=>e!==void 0&&e!==t;function zt(e,t,n,o,a,c){if(!H[e]){const s=b().createReverb(t,n,o,a,c);s.connect(we()),H[e]=s}return(_(t,H[e].duration)||_(n,H[e].fade)||_(o,H[e].lp)||_(a,H[e].dim)||H[e].ir!==c)&&H[e].generate(t,n,o,a,c),H[e]}let K;function Dt(e=2048){if(!K){const t=b().createAnalyser();t.fftSize=e,K=t,new Float32Array(K.frequencyBinCount)}return K.fftSize!==e&&(K.fftSize=e,new Float32Array(K.frequencyBinCount)),K}function pe(e,t,n){const o=te(n);return e.connect(o),o.connect(t),o}const he=async(e,t,n)=>{const o=b();if(typeof e!="object")throw new Error(`expected hap.value to be an object, but got "${e}". Hint: append .note() or .s() to the end`,"error");e.duration=n;let a=o.currentTime+t,{s:c="triangle",bank:s,source:i,gain:l=.8,postgain:u=1,ftype:d="12db",fanchor:g=.5,cutoff:f,lpenv:p,lpattack:h=.01,lpdecay:C=.01,lpsustain:B=1,lprelease:y=.01,resonance:M=1,hpenv:G,hcutoff:R,hpattack:V=.01,hpdecay:v=.01,hpsustain:D=1,hprelease:x=.01,hresonance:E=1,bpenv:S,bandf:m,bpattack:Z=.01,bpdecay:j=.01,bpsustain:O=1,bprelease:oe=.01,bandq:Q=1,phaser:L,phaserdepth:X=.75,phasersweep:ae,phasercenter:q,coarse:P,crush:Re,shape:Ve,pan:Xe,vowel:Te,delay:Me=0,delayfeedback:Ze=.5,delaytime:He=.25,orbit:re=1,room:We,roomfade:_e,roomlp:et,roomdim:tt,roomsize:nt,ir:ce,i:Ne=0,velocity:ot=1,analyze:ke,fft:at=8,compressor:Ke,compressorRatio:rt,compressorKnee:ct,compressorAttack:it,compressorRelease:st}=e;l*=ot;let Fe=[];const lt=()=>{Fe.forEach(I=>I==null?void 0:I.disconnect())};s&&c&&(c=`${s}_${c}`);let U;if(i)U=i(a,e,n);else if(ue(c)){const{onTrigger:I}=ue(c),N=await I(a,e,lt);N&&(U=N.node,N.stop(a+n))}else throw new Error(`sound ${c} not found! Is it loaded?`);if(!U)return;if(o.currentTime>a){z("[webaudio] skip hap: still loading",o.currentTime-a);return}const A=[];if(A.push(U),A.push(te(l)),f!==void 0){let I=()=>se(o,"lowpass",f,M,h,C,B,y,p,a,a+n,g);A.push(I()),d==="24db"&&A.push(I())}if(R!==void 0){let I=()=>se(o,"highpass",R,E,V,v,D,x,G,a,a+n,g);A.push(I()),d==="24db"&&A.push(I())}if(m!==void 0){let I=()=>se(o,"bandpass",m,Q,Z,j,O,oe,S,a,a+n,g);A.push(I()),d==="24db"&&A.push(I())}if(Te!==void 0){const I=o.createVowelFilter(Te);A.push(I)}if(P!==void 0&&A.push(fe(o,"coarse-processor",{coarse:P})),Re!==void 0&&A.push(fe(o,"crush-processor",{crush:Re})),Ve!==void 0&&A.push(fe(o,"shape-processor",{shape:Ve})),Ke!==void 0&&A.push(wt(o,Ke,rt,ct,it,st)),Xe!==void 0){const I=o.createStereoPanner();I.pan.value=2*Xe-1,A.push(I)}if(L!==void 0&&X>0){const I=Yt(re,a,L,X,q,ae);A.push(I)}const J=te(u);A.push(J),J.connect(we());let Ye;if(Me>0&&He>0&&Ze>0){const I=Ft(re,He,Ze,a);Ye=pe(J,I,Me)}let ze;if(We>0){let I;if(ce!==void 0){let ie,F=ue(ce);Array.isArray(F)?ie=F.data.samples[Ne%F.data.samples.length]:typeof F=="object"&&(ie=Object.values(F.data.samples).flat()[Ne%Object.values(F.data.samples).length]),I=await qe(ie,o,ce,0)}const N=zt(re,nt,_e,et,tt,I);ze=pe(J,N,We)}let De;if(ke){const I=Dt(2**(at+5));De=pe(J,I,ke)}A.slice(1).reduce((I,N)=>I.connect(N),A[0]),Fe=A.concat([Ye,ze,De])};let Ie={};function xt(e){const t=b();if(Ie[e])return Ie[e];const n=2*t.sampleRate,o=t.createBuffer(1,n,t.sampleRate),a=o.getChannelData(0);let c=0,s,i,l,u,d,g,f;s=i=l=u=d=g=f=0;for(let p=0;p<n;p++)if(e==="white")a[p]=Math.random()*2-1;else if(e==="brown"){let h=Math.random()*2-1;a[p]=(c+.02*h)/1.02,c=a[p]}else if(e==="pink"){let h=Math.random()*2-1;s=.99886*s+h*.0555179,i=.99332*i+h*.0750759,l=.969*l+h*.153852,u=.8665*u+h*.3104856,d=.55*d+h*.5329522,g=-.7616*g-h*.016898,a[p]=s+i+l+u+d+g+f+h*.5362,a[p]*=.11,f=h*.115926}return Ie[e]=o,o}function Pe(e="white",t){const n=b().createBufferSource();return n.buffer=xt(e),n.loop=!0,n.start(t),{node:n,stop:o=>n.stop(o)}}function St(e,t,n){const o=Pe("pink",n);return{node:Gt(e,o.node,t),stop:a=>o==null?void 0:o.stop(a)}}const jt=(e,t=1,n="sine")=>{const o=b(),a=o.createOscillator();a.type=n,a.frequency.value=e,a.start();const c=new GainNode(o,{gain:t});return a.connect(c),{node:c,stop:s=>a.stop(s)}},Ot=(e,t,n,o="sine")=>{const a=e.frequency.value*t,c=a*n;return jt(a,c,o)},Oe=["sine","square","triangle","sawtooth"],Qt=["pink","white","brown"];function Lt(){[...Oe,...Qt].forEach(e=>{Ee(e,(t,n,o)=>{let{attack:a=.001,decay:c=.05,sustain:s=.6,release:i=.01}=n,l;Oe.includes(e)?l=Jt(e,t,n):l=Pe(e,t);let{node:u,stop:d,triggerRelease:g}=l;const f=te(.3),{node:p,stop:h}=ve(a,c,s,i,1,t);return u.onended=()=>{u.disconnect(),f.disconnect(),o()},{node:u.connect(f).connect(p),stop:C=>{h(C),g==null||g(C);let B=C+i;d(B)}}},{type:"synth",prebake:!0})})}function qt(e,t){const n=new Float32Array(e+1),o=new Float32Array(e+1),a=b(),c=a.createOscillator(),s={sawtooth:u=>[0,-1/u],square:u=>[0,u%2===0?0:1/u],triangle:u=>[u%2===0?0:1/(u*u),0]};if(!s[t])throw new Error(`unknown wave type ${t}`);n[0]=0,o[0]=0;let i=1;for(;i<=e;){const[u,d]=s[t](i);n[i]=u,o[i]=d,i++}const l=a.createPeriodicWave(n,o);return c.setPeriodicWave(l),c}function Jt(e,t,{n,note:o,freq:a,vib:c=0,vibmod:s=.5,noise:i=0,fmh:l=1,fmi:u,fmenv:d="lin",fmattack:g,fmdecay:f,fmsustain:p,fmrelease:h,fmvelocity:C,fmwave:B="sine"}){b();let y;!n||e==="sine"?(y=b().createOscillator(),y.type=e||"triangle"):y=qt(n,e),o=o||36,typeof o=="string"&&(o=Ae(o)),!a&&typeof o=="number"&&(a=mt(o)),y.frequency.value=Number(a),y.start(t);let M,G;if(u){const{node:v,stop:D}=Ot(y,l,u,B);[g,f,p,h,C].find(x=>x!==void 0)?(g=g??.001,f=f??.001,p=p??1,h=h??.001,C=C??1,G=ve(g,f,p,h,C,t),d==="exp"&&(G=vt(g,f,p,h,C,t),G.node.maxValue=u*2,G.node.minValue=1e-5),v.connect(G.node),G.node.connect(y.frequency)):v.connect(y.frequency),M=D}let R;if(c>0){R=b().createOscillator(),R.frequency.value=c;const v=b().createGain();v.gain.value=s*100,R.connect(v),v.connect(y.detune),R.start(t)}let V;return i&&(V=St(y,i,t)),{node:(V==null?void 0:V.node)||y,stop:v=>{R==null||R.stop(v),V==null||V.stop(v),M==null||M(v),y.stop(v)},triggerRelease:v=>{G==null||G.stop(v)}}}let be;const Et=()=>{};typeof window<"u"&&window.addEventListener("message",e=>{var t;e.data==="strudel-stop"?Et():(t=e.data)!=null&&t.dough&&(be==null||be.node.port.postMessage(e.data))});AudioContext.prototype.createClock=function(e,t,n=.1,o=.1){let a=0,c=0,s=10**4,i=.01;const l=p=>t=p(t);o=o||n/2;const u=()=>{const p=this.currentTime,h=p+n+o;for(c===0&&(c=p+i);c<h;)c=Math.round(c*s)/s,c>=p&&e(c,t,a),c+=t,a++};let d;const g=()=>{u(),d=setInterval(u,n*1e3)},f=()=>clearInterval(d);return{setDuration:l,start:g,stop:()=>{a=0,c=0,f()},pause:()=>f(),duration:t}};function Pt(e){function t(i){return e.tick%i===0}function n(i,l=0){return(Array.isArray(i)?i:[i]).some(u=>!((e.tick-l*e.tps)%Math.floor(u*e.tps)))}function o(i,l,u,d=0){return n(i)&&Ut(l,u,d).beat(i)}let a=()=>e.tick/e.tps;Array.prototype.beat=function(i=1){return this[Math.floor(a()/i)%this.length]},Array.prototype.dur=function(...i){let l=0;i=i.map(g=>{let f=l;return l+=g,f});let u=a()%l,d=i.indexOf(i.findLast(g=>u>=g));return this[d]};let c=(i,l,u)=>i*(u-l)+l;return{pulse:t,beat:n,rhythm:o,getBeat:a,range:c,usine:i=>(Math.sin(e.t*i*Math.PI*2)+1)/2,r:(i,l)=>c(Math.random(),i,l),ir:(i,l)=>Math.round(r(i,l)),lpad:(i,l,u)=>({lpenv:i,lpattack:l,lpdecay:u,lpsustain:0}),ad:(i,l)=>({attack:i,decay:l,sustain:0})}}function Ut(e,t,n=0){if(e==t)return Array.from({length:t},()=>!0);function o(s,i){const l=s.length,u=(i+1)%l;return s[i]>s[u]}if(e>=t)return[!0];const a=Array.from({length:t},(s,i)=>(e*(i-1)%t+t)%t);let c=a.map((s,i)=>o(a,i));return n!=0&&(c=c.slice(n).concat(c.slice(0,n))),c}const $t=Promise.all([Kt({disableWorklets:!1}),Be("github:tidalcycles/Dirt-Samples/master"),Lt()]),ne=1/48,_t=1/ne;console.log("hello");const T={tps:_t,tickDuration:ne},Qe=.01;Object.assign(window,{getAudioContext:b,superdough:he,samples:Be,p(e){const{duration:t=.25,nudge:n=0,chord:o,...a}=e;if(!o)return he(a,T.deadline+n+Qe,t);let c={C:["c4","e4","g4"],G:["b3","d4","g4"],Am7:["a4","c5","e5","g5"],Bm7:["b4","d5","f#5","a5"]};if(!c[o]){console.error("chord not found",o);return}return c[o].map(s=>he({...a,note:s},T.deadline+n+Qe,t))},bpm:e=>{Y.setDuration(()=>ne*60/e)},...Pt(T)});let en=`
bpm(93)

function tick() {
  beat(.5) && p({s:"hh"})
  beat(1) && p({s:"bd"})
  beat(2) && p({s:"sd"})
  beat([.75,1],.5) && p({s:"jvbass",delay:.25})
  beat(1,.5) 
  && p({note:"f#",room:1},.25) 
  && p({note:"a",room:1},.15)
}
`.trim();const Le=window.location.href.split("#")[1]||"";let ee=Le?rn(Le):en;function tn(e){const t=`"use strict"; return (async () => {
${e}
return tick
})()`;return Function(t).call(T)}let Y,Ce;function nn(){if(Y)return Y;Y=b().createClock((e,t,n)=>{T.deadline=e-b().currentTime,T.t=e,T.tick=n;try{T.ticker&&T.ticker(T)}catch(o){console.error(o)}},ne)}async function Ue(){await $t,nn(),await on(),Ce||(Y.start(),Ce=!0)}function $e(){Y.stop(),Ce=!1}const Ge=document.getElementById("code");async function on(){ee=Ge.value,T.ticker=await tn(ee),window.location.hash=btoa(ee)}Ge.innerHTML=ee;Ge.addEventListener("keydown",e=>{e.ctrlKey&&e.key==="Enter"&&Ue(),e.ctrlKey&&e.key==="."&&$e()});document.getElementById("play").addEventListener("click",()=>Ue());document.getElementById("stop").addEventListener("click",()=>$e());function an(e){const t=new Uint8Array(atob(e).split("").map(o=>o.charCodeAt(0)));return new TextDecoder().decode(t)}function rn(e){return an(decodeURIComponent(e))}
